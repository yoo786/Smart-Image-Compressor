 <!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Image Compressor | Chand</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: rgba(255,255,255,0.05);
      --accent: #38bdf8;
      --text: #e6eef6;
      --muted: #9ca3af;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", system-ui, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start; /* ðŸ‘ˆ heading thoda upar */
      min-height: 100vh;
      padding: 40px 16px 16px;
    }
    .container {
      width: 100%;
      max-width: 900px;
      background: var(--panel);
      border-radius: 16px;
      padding: 30px 28px 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      backdrop-filter: blur(12px);
    }
    h1 {
      text-align: center;
      font-size: 26px;
      margin-bottom: 20px;
      color: var(--accent);
      letter-spacing: 0.5px;
      text-shadow: 0 0 10px rgba(56,189,248,0.4);
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }
    label { font-size: 14px; color: var(--muted); }
    input[type="number"], select {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--text);
      padding: 8px;
      min-width: 80px;
      outline: none;
    }
    input[type="file"] { color: var(--muted); }
    button {
      background: var(--accent);
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      color: #031220;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background: #4dd8f8; transform: scale(1.05); }
    .preview {
      text-align: center;
      background: rgba(255,255,255,0.07);
      padding: 14px;
      border-radius: 12px;
      margin-top: 10px;
    }
    img {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 8px;
    }
    .meta {
      margin-top: 8px;
      color: var(--muted);
      font-size: 14px;
    }
    .history {
      margin-top: 20px;
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 10px;
      max-height: 180px;
      overflow-y: auto;
      font-size: 13px;
    }
    .history-item {
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 4px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“¸ Smart Image Compressor</h1>
    <div class="controls">
      <input type="file" id="fileInput" accept="image/*">
      <label>Target size (KB):</label>
      <input type="number" id="targetKB" value="200" min="10">
      <label>Max width (px):</label>
      <input type="number" id="maxWidth" value="1920" min="100">
      <label>Format:</label>
      <select id="formatSelect">
        <option value="image/jpeg">JPG</option>
        <option value="image/png">PNG</option>
        <option value="image/webp">WEBP</option>
      </select>
      <button id="compressBtn">Compress</button>
      <button id="downloadBtn" disabled>Download</button>
    </div>

    <div class="preview">
      <div id="statusText">No image selected</div>
      <img id="previewImg" alt="Preview" style="display:none;">
      <div class="meta">
        Original: <span id="origSize">-</span> â†’ Compressed: <span id="compSize">-</span>
      </div>
    </div>

    <div class="history" id="historyBox">
      <div><b>History</b></div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const targetKB = document.getElementById('targetKB');
    const maxWidth = document.getElementById('maxWidth');
    const formatSelect = document.getElementById('formatSelect');
    const compressBtn = document.getElementById('compressBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const previewImg = document.getElementById('previewImg');
    const origSizeEl = document.getElementById('origSize');
    const compSizeEl = document.getElementById('compSize');
    const historyBox = document.getElementById('historyBox');
    const statusText = document.getElementById('statusText');

    let originalFile = null;
    let compressedBlob = null;

    fileInput.addEventListener('change', e => {
      originalFile = e.target.files[0];
      if (!originalFile) return;
      const reader = new FileReader();
      reader.onload = e => {
        previewImg.src = e.target.result;
        previewImg.style.display = 'block';
        statusText.textContent = originalFile.name;
        origSizeEl.textContent = formatBytes(originalFile.size);
      };
      reader.readAsDataURL(originalFile);
    });

    compressBtn.addEventListener('click', async () => {
      if (!originalFile) return alert('Please select an image');
      const img = new Image();
      img.src = URL.createObjectURL(originalFile);
      img.onload = async () => {
        const targetBytes = targetKB.value * 1024;
        const format = formatSelect.value;
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        let scale = Math.min(1, maxWidth.value / img.width);
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        let low = 0.8, high = 1.0, best = null;
        for (let i = 0; i < 8; i++) {
          const q = (low + high) / 2;
          const blob = await toBlob(canvas, format, q);
          if (blob.size > targetBytes) high = q; else low = q;
          if (!best || Math.abs(blob.size - targetBytes) < Math.abs(best.size - targetBytes))
            best = blob;
        }

        compressedBlob = best;
        const url = URL.createObjectURL(best);
        previewImg.src = url;
        compSizeEl.textContent = formatBytes(best.size);
        downloadBtn.disabled = false;
        addHistory(originalFile.name, formatBytes(originalFile.size), formatBytes(best.size), format.split('/')[1].toUpperCase());
      };
    });

    downloadBtn.addEventListener('click', () => {
      if (!compressedBlob) return;
      const a = document.createElement('a');
      const ext = formatSelect.value.split('/')[1];
      a.href = URL.createObjectURL(compressedBlob);
      a.download = `compressed.${ext}`;
      a.click();
    });

    function toBlob(canvas, type, quality) {
      return new Promise(resolve => canvas.toBlob(resolve, type, quality));
    }

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
      return (bytes / 1048576).toFixed(2) + ' MB';
    }

    function addHistory(name, orig, comp, fmt) {
      const div = document.createElement('div');
      div.className = 'history-item';
      div.textContent = `${name} | ${orig} â†’ ${comp} | Format: ${fmt} | ${new Date().toLocaleTimeString()}`;
      historyBox.appendChild(div);
    }
  </script>
</body>
</html>
